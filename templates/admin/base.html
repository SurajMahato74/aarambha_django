{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Dashboard{% endblock %} â€¢ Aarambha Foundation</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

  <link rel="icon" type="image.png" href="{% static 'website/images/favicon.png' %}" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="{% static 'js/config.js' %}"></script>
    {% block extra_head %}{% endblock %}
    <style>
        body {
            background: #0f172a;
            color: #cbd5e1;
            font-family: 'Inter', sans-serif;
        }

        .sidebar {
            background: #1e293b;
        }

        .card {
            background: #1e293b;
            border: 1px solid #334155;
        }

        .active {
            background: #312e81;
            border-left: 3px solid #818cf8;
        }

        .hover-bg:hover {
            background: #293548;
        }

        .badge {
            font-size: 0.68rem;
            padding: 2px 8px;
            border-radius: 6px;
        }
    </style>
</head>

<body class="text-sm">

    <!-- Global Loader -->
    <div id="global-loader" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="animate-spin rounded-full h-32 w-32 border-b-2 border-white"></div>
    </div>

    <div class="flex h-screen">
        <!-- Sidebar -->
        <aside class="w-56 sidebar flex flex-col fixed h-screen">
            <div class="p-5 border-b border-slate-700">
                <h2 class="font-semibold text-white flex items-center gap-2">
                    <span class="text-xl">Foundation</span> Aarambha
                </h2>
                <p class="text-xs text-indigo-400">Super Admin</p>
            </div>

            <nav class="flex-1 px-3 py-4 space-y-1 overflow-y-auto">
                <a href="{% url 'admin_dashboard' %}"
                    class="menu-link hover-bg flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 {% if request.resolver_match.url_name == 'admin_dashboard' %}active text-indigo-300 font-medium{% endif %}">
                    <i class="fas fa-chart-line w-4"></i> Dashboard
                </a>
                <a href="{% url 'admin_users' %}"
                    class="menu-link hover-bg flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 {% if request.resolver_match.url_name == 'admin_users' %}active text-indigo-300 font-medium{% endif %}">
                    <i class="fas fa-users w-4"></i> Users
                </a>
                <a href="{% url 'admin_branches' %}"
                    class="menu-link hover-bg flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 {% if request.resolver_match.url_name == 'admin_branches' %}active text-indigo-300 font-medium{% endif %}">
                    <i class="fas fa-building w-4"></i> Branches
                </a>
                <a href="{% url 'admin_applications' %}"
                    class="menu-link hover-bg flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 {% if request.resolver_match.url_name == 'admin_applications' %}active text-indigo-300 font-medium{% endif %}">
                    <i class="fas fa-file-lines w-4"></i> Applications
                </a>
                <a href="{% url 'admin_sponsorships' %}"
                    class="menu-link hover-bg flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 {% if request.resolver_match.url_name == 'admin_sponsorships' %}active text-indigo-300 font-medium{% endif %}">
                    <i class="fas fa-heart w-4"></i> Child Sponsorships
                </a>
                <a href="{% url 'admin_sponsorship_payments' %}"
                    class="menu-link hover-bg flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 {% if request.resolver_match.url_name == 'admin_sponsorship_payments' %}active text-indigo-300 font-medium{% endif %}">
                    <i class="fas fa-money-bill-wave w-4"></i> Payment Details
                </a>
                <a href="{% url 'admin_one_rupee_campaign' %}"
                    class="menu-link hover-bg flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 {% if request.resolver_match.url_name == 'admin_one_rupee_campaign' %}active text-indigo-300 font-medium{% endif %}">
                    <i class="fas fa-coins w-4"></i> One Rupee Campaign
                </a>
                <a href="{% url 'admin_birthday_campaigns' %}"
                    class="menu-link hover-bg flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 {% if request.resolver_match.url_name == 'admin_birthday_campaigns' %}active text-indigo-300 font-medium{% endif %}">
                    <i class="fas fa-birthday-cake w-4"></i> Birthday Campaigns
                </a>
                <a href="{% url 'admin_donations' %}"
                    class="menu-link hover-bg flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 {% if request.resolver_match.url_name == 'admin_donations' %}active text-indigo-300 font-medium{% endif %}">
                    <i class="fas fa-donate w-4"></i> Donations
                </a>
                <a href="{% url 'admin_payment_history' %}"
                    class="menu-link hover-bg flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 {% if request.resolver_match.url_name == 'admin_payment_history' %}active text-indigo-300 font-medium{% endif %}">
                    <i class="fas fa-history w-4"></i> Payment History
                </a>
                <a href="{% url 'admin_children' %}"
                    class="menu-link hover-bg flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 {% if request.resolver_match.url_name == 'admin_children' %}active text-indigo-300 font-medium{% endif %}">
                    <i class="fas fa-child w-4"></i> Children Database
                </a>
                <a href="{% url 'admin_tasks' %}"
                    class="menu-link hover-bg flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 {% if request.resolver_match.url_name == 'admin_tasks' %}active text-indigo-300 font-medium{% endif %}">
                    <i class="fas fa-tasks w-4"></i> Tasks
                </a>
                <a href="{% url 'admin_notices' %}"
                    class="menu-link hover-bg flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 {% if request.resolver_match.url_name == 'admin_notices' %}active text-indigo-300 font-medium{% endif %}">
                    <i class="fas fa-bullhorn w-4"></i> Notices
                </a>
                <a href="{% url 'admin_materials' %}"
                    class="menu-link hover-bg flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 {% if request.resolver_match.url_name == 'admin_materials' %}active text-indigo-300 font-medium{% endif %}">
                    <i class="fas fa-book w-4"></i> Reading Materials
                </a>
                <a href="{% url 'admin_event_management' %}"
                    class="menu-link hover-bg flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 {% if request.resolver_match.url_name == 'admin_event_management' or request.resolver_match.url_name == 'admin_event_participations' %}active text-indigo-300 font-medium{% endif %}">
                    <i class="fas fa-calendar-alt w-4"></i> Event Management
                </a>
                <a href="{% url 'admin_school_dropout_reports_new' %}"
                    class="menu-link hover-bg flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 {% if request.resolver_match.url_name == 'admin_school_dropout_reports_new' %}active text-indigo-300 font-medium{% endif %}">
                    <i class="fas fa-graduation-cap w-4"></i> School Dropout Reports
                </a>
                <a href="{% url 'admin_recommendation_letters' %}"
                    class="menu-link hover-bg flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 {% if request.resolver_match.url_name == 'admin_recommendation_letters' %}active text-indigo-300 font-medium{% endif %}">
                    <i class="fas fa-file-alt w-4"></i> Recommendation Letters
                </a>

                <!-- Content Management Section -->
                <div class="pt-2 mt-2 border-t border-slate-700">
                    <p class="px-4 py-2 text-xs font-semibold text-slate-500 uppercase tracking-wider">Content
                        Management</p>

                    <!-- Index Page Submenu -->
                    <div class="space-y-1">
                        <button onclick="toggleSubmenu('indexPageSubmenu')"
                            class="menu-link hover-bg flex items-center justify-between w-full px-4 py-2.5 rounded-lg text-slate-300">
                            <span class="flex items-center gap-3">
                                <i class="fas fa-home w-4"></i> Index Page
                            </span>
                            <i class="fas fa-chevron-down text-xs transition-transform" id="indexPageSubmenuIcon"></i>
                        </button>

                        <div id="indexPageSubmenu" class="hidden pl-8 space-y-1">
                            <a href="{% url 'admin_herosection' %}"
                                class="menu-link hover-bg flex items-center gap-3 px-4 py-2 rounded-lg text-slate-400 text-sm {% if request.resolver_match.url_name == 'admin_herosection' %}active text-indigo-300 font-medium{% endif %}">
                                <i class="fas fa-image w-4"></i> Hero Section
                            </a>
                            <a href="{% url 'admin_supportcards' %}"
                                class="menu-link hover-bg flex items-center gap-3 px-4 py-2 rounded-lg text-slate-400 text-sm {% if request.resolver_match.url_name == 'admin_supportcards' %}active text-indigo-300 font-medium{% endif %}">
                                <i class="fas fa-heart w-4"></i> Support Cards
                            </a>
                            <a href="{% url 'admin_whoweare' %}"
                                class="menu-link hover-bg flex items-center gap-3 px-4 py-2 rounded-lg text-slate-400 text-sm {% if request.resolver_match.url_name == 'admin_whoweare' %}active text-indigo-300 font-medium{% endif %}">
                                <i class="fas fa-users w-4"></i> Who We Are
                            </a>
                            <a href="{% url 'admin_growingimpact' %}"
                                class="menu-link hover-bg flex items-center gap-3 px-4 py-2 rounded-lg text-slate-400 text-sm {% if request.resolver_match.url_name == 'admin_growingimpact' %}active text-indigo-300 font-medium{% endif %}">
                                <i class="fas fa-chart-line w-4"></i> Growing Our Impact
                            </a>
                            <a href="{% url 'admin_statistics' %}"
                                class="menu-link hover-bg flex items-center gap-3 px-4 py-2 rounded-lg text-slate-400 text-sm {% if request.resolver_match.url_name == 'admin_statistics' %}active text-indigo-300 font-medium{% endif %}">
                                <i class="fas fa-chart-bar w-4"></i> Statistics
                            </a>
                            <a href="{% url 'admin_events' %}"
                                class="menu-link hover-bg flex items-center gap-3 px-4 py-2 rounded-lg text-slate-400 text-sm {% if request.resolver_match.url_name == 'admin_events' %}active text-indigo-300 font-medium{% endif %}">
                                <i class="fas fa-calendar w-4"></i> Events (Content)
                            </a>
                            <a href="{% url 'admin_partners' %}"
                                class="menu-link hover-bg flex items-center gap-3 px-4 py-2 rounded-lg text-slate-400 text-sm {% if request.resolver_match.url_name == 'admin_partners' %}active text-indigo-300 font-medium{% endif %}">
                                <i class="fas fa-handshake w-4"></i> Partners
                            </a>
                            <a href="{% url 'admin_contact' %}"
                                class="menu-link hover-bg flex items-center gap-3 px-4 py-2 rounded-lg text-slate-400 text-sm {% if request.resolver_match.url_name == 'admin_contact' %}active text-indigo-300 font-medium{% endif %}">
                                <i class="fas fa-phone w-4"></i> Contact Info
                            </a>
                            <a href="{% url 'admin_awards' %}"
                                class="menu-link hover-bg flex items-center gap-3 px-4 py-2 rounded-lg text-slate-400 text-sm {% if request.resolver_match.url_name == 'admin_awards' %}active text-indigo-300 font-medium{% endif %}">
                                <i class="fas fa-trophy w-4"></i> Awards
                            </a>
                            <a href="{% url 'admin_ourwork' %}"
                                class="menu-link hover-bg flex items-center gap-3 px-4 py-2 rounded-lg text-slate-400 text-sm {% if request.resolver_match.url_name == 'admin_ourwork' %}active text-indigo-300 font-medium{% endif %}">
                                <i class="fas fa-briefcase w-4"></i> Our Work
                            </a>
                            <a href="{% url 'admin_blogs' %}"
                                class="menu-link hover-bg flex items-center gap-3 px-4 py-2 rounded-lg text-slate-400 text-sm {% if request.resolver_match.url_name == 'admin_blogs' %}active text-indigo-300 font-medium{% endif %}">
                                <i class="fas fa-blog w-4"></i> Blogs
                            </a>
                        </div>
                    </div>
                </div>
            </nav>

            <div class="p-3 border-t border-slate-700">
                <form method="POST" action="{% url 'logout' %}">
                    {% csrf_token %}
                    <button type="submit" onclick="clearToken()"
                        class="w-full flex items-center gap-3 px-4 py-2.5 rounded-lg text-rose-400 hover:bg-rose-900/20">
                        <i class="fas fa-arrow-right-from-bracket w-4"></i> Logout
                    </button>
                </form>
            </div>

        </aside>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto ml-56 px-6 py-4">
            <!-- Header -->
            <div
                class="flex justify-between items-center mb-6 sticky top-0 bg-slate-900/95 backdrop-blur-sm py-4 px-6 z-10">
                <h1 class="text-2xl font-semibold text-white">{% block page_title %}Dashboard{% endblock %}</h1>
                <div class="flex items-center gap-3">
                    <span id="userName" class="text-sm font-medium text-slate-300"></span>
                    <div class="w-8 h-8 rounded-full bg-indigo-600 flex items-center justify-center text-xs font-bold text-white"
                        id="userInitial">S</div>
                </div>
            </div>

            {% block content %}{% endblock %}
        </main>
    </div>

    <script>
        const user = getUser();
        if (!user || (!user.is_superuser && user.user_type !== 'superadmin')) {
            window.location.href = '{% url "login" %}';
        }
        const fullName = user.first_name ? `${user.first_name} ${user.last_name || ''}` : user.username;
        document.getElementById('userName').textContent = fullName;
        document.getElementById('userInitial').textContent = (user.first_name?.[0] || user.username?.[0] || 'U').toUpperCase();

        // Toggle submenu function
        function toggleSubmenu(submenuId) {
            const submenu = document.getElementById(submenuId);
            const icon = document.getElementById(submenuId + 'Icon');

            if (submenu.classList.contains('hidden')) {
                submenu.classList.remove('hidden');
                icon.style.transform = 'rotate(180deg)';
            } else {
                submenu.classList.add('hidden');
                icon.style.transform = 'rotate(0deg)';
            }
        }
    </script>
</body>

</html>