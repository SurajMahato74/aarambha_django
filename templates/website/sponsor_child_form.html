{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css" />
    <link href="{% static 'website/css/bootstrap.min.css' %}" rel="stylesheet" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="{% static 'website/css/slick.min.css' %}" crossorigin="anonymous"
        referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="{% static 'website/css/owl.carousel.min.css' %}" />
    <!-- Link Swiper's CSS -->
    <link rel="stylesheet" href="{% static 'website/css/swiper-bundle.min.css' %}" />
    <!-- Link Swiper's CSS end-->
    <link rel="stylesheet" href="{% static 'website/css/animate.min.css' %}" />
    <!-- custom-css  -->
    <link rel="stylesheet" href="{% static 'website/css/index.css' %}" />
    <link rel="stylesheet" href="{% static 'website/css/style.css' %}" />
    <!-- custom-css end -->
    <link rel="icon" type="image/png" href="{% static 'website/images/favicon.png' %}" />
    <title>Aarambha Foundation â€“ Sponsor a Child</title>
    <style>
        .header-top img {
            width: 100%;
            max-height: 250px;
            object-fit: cover;
            border-radius: 10px;
        }

        .header-bottom {
            color: #2d3b5b;
            background-color: #fff;
            border-top: 10px solid #8f5556;
            border-left: 1px solid #8f5556;
            border-right: 1px solid #8f5556;
            border-bottom: 1px solid #8f5556;
            padding: 5px 20px;
            border-radius: 10px 10px 0 0;
        }

        .header-bottom h1 {
            margin: 0;
            font-size: 25px;
        }

        .header-bottom .header-content p {
            color: #0b0b0b;
            text-align: justify;
        }

        .content {
            line-height: 1.6;
        }

        .start-section h2 {
            margin: 0;
            padding: 0;
        }

        .start-btn {
            background: #2d3b5b;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 18px;
            cursor: pointer;
        }

        .start-btn:hover {
            background: #8f5556;
        }

        .btn-success {
            background: #8f5556 !important;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 18px;
            cursor: pointer;
        }

        .btn-success:hover {
            background: #2d3b5b !important;
        }

        .form-step {
            display: none;
        }

        .form-step h2 {
            font-size: 18px;
            font-weight: 600;
        }

        .form-step p {
            color: #171717;
        }

        .form-step.active {
            display: block;
        }

        .form-group {
            margin-bottom: 10px;
        }

        label {
            text-align: left !important;
            color: #000;
            text-transform: capitalize;
            font-weight: 400;
        }

        input[type="text"],
        input[type="date"],
        input[type="email"],
        input[type="tel"],
        select,
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 16px;
            box-sizing: border-box;
        }

        .required {
            color: red;
        }

        .progress {
            text-align: center;
            margin: 20px 0;
            font-weight: bold;
            color: #8b6f47;
        }

        #sponsorshipForm {
            display: none;
        }

        input[type="radio"],
        input[type="checkbox"] {
            margin-right: 8px;
        }
    </style>
</head>

<body>
    {% include 'website/includes/navbar.html'%}
    {% include 'website/includes/login_modal.html'%}

    <div class="container member-section">
        <div class="row justify-content-center">
            <div class="col-12 col-md-8 wow fadeInUp">
                <div class="header-top " style="margin-top: 100px; margin-bottom: 10px">
                    <img src="{% static 'website/images/help.jpg' %}" alt="Aarambha Foundation" />
                </div>
                <div class="header-bottom mb-3 wow fadeInUp" data-wow-duration="1s" data-wow-delay="0.2s">
                    <h1>Sponsor a Child | Aarambha Foundation</h1>
                    <div class="header-content">
                        <h3>What is Child Sponsorship?</h3>
                        <p>
                            Child sponsorship is a powerful way to make a direct, lasting impact on a child's life.
                            Through Aarambha Foundation, your sponsorship provides comprehensive support including:
                        </p>
                        <ul style="text-align: left; margin: 20px 0;">
                            <li><strong>Education:</strong> School fees, uniforms, books, stationery, and school
                                supplies</li>
                            <li><strong>Healthcare:</strong> Medical check-ups, vaccinations, and emergency medical care
                            </li>
                            <li><strong>Nutrition:</strong> Daily meals and nutritional supplements</li>
                            <li><strong>Personal Development:</strong> Extra-curricular activities, skill development
                                programs</li>
                            <li><strong>Monitoring & Support:</strong> Regular progress tracking and mentorship</li>
                        </ul>

                        <h3>How Sponsorship Works</h3>
                        <p>
                            <strong>Step 1:</strong> Complete the application form<br>
                            <strong>Step 2:</strong> We'll match you with a child in need<br>
                            <strong>Step 3:</strong> Make your contribution<br>
                            <strong>Step 4:</strong> Receive updates, photos, and letters from your sponsored child<br>
                            <strong>Step 5:</strong> Witness the transformation and continue making a difference
                        </p>
                    </div>
                    <hr style="border: 1px solid #000" />
                    <div class="content">
                        <div class="start-section mb-3" id="startSection">
                            <h3 class="mt-1 pb-0">Ready to Sponsor a Child?</h3>
                            <p class="mb-0">
                                Fill out the form below to start the sponsorship process. (This is a dummy form for
                                demonstration purposes.)
                            </p>
                            <button class="start-btn" onclick="startApplication()">
                                Start Sponsorship
                            </button>
                        </div>
                        <form class="pb-4" id="sponsorshipForm">
                            <div class="row">
                                <!-- Personal Information Section -->
                                <div class="col-12 mb-4">
                                    <h3 style="color: #2d3b5b; border-bottom: 2px solid #8f5556; padding-bottom: 5px;">Your Information</h3>
                                    <p style="color: #666;">Please provide your details to proceed with the sponsorship.</p>
                                </div>
                                
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="name">Full Name <span class="required">*</span></label>
                                        <input type="text" id="name" name="full_name" placeholder="First and last name" required />
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="email">Email Address <span class="required">*</span></label>
                                        <input type="email" id="email" name="email" placeholder="your@email.com" required />
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="phone">Phone Number <span class="required">*</span></label>
                                        <input type="tel" id="phone" name="phone" placeholder="+977 9800000000" required />
                                    </div>
                                </div>
                                
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="country">Country <span class="required">*</span></label>
                                        <select id="country" name="country" required>
                                            <option value="">Select Country</option>
                                            <option value="Nepal" selected>Nepal</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="city">City <span class="required">*</span></label>
                                        <input type="text" id="city" name="city" placeholder="Your city" required />
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="address">Street Address <span class="required">*</span></label>
                                        <input type="text" id="address" name="address" placeholder="Street address" required />
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="occupation">Occupation</label>
                                        <input type="text" id="occupation" name="occupation" placeholder="Your profession" />
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="organization">Organization/Company</label>
                                        <input type="text" id="organization" name="organization" placeholder="Company name" />
                                    </div>
                                </div>

                                <!-- Sponsorship Preferences Section -->
                                <div class="col-12 mb-4 mt-4">
                                    <h3 style="color: #2d3b5b; border-bottom: 2px solid #8f5556; padding-bottom: 5px;">Sponsorship Preferences</h3>
                                    <p style="color: #666;">Choose how you'd like to contribute and specify your preferences.</p>
                                </div>
                                
                                <div class="col-12">
                                    <div class="form-group">
                                        <label>Sponsorship Type <span class="required">*</span></label>
                                        <div style="margin-top: 12px; display: flex; flex-direction: column; gap: 12px;">
                                            <label><input type="radio" name="sponsorship_type" value="Full Sponsorship" required />
                                                Full Sponsorship (Rs. 12,000/year) - Complete support for one child</label>
                                            <label><input type="radio" name="sponsorship_type" value="Partial Sponsorship" required />
                                                Partial Sponsorship (Rs. 6,000/year) - Share sponsorship with another donor</label>
                                            <label><input type="radio" name="sponsorship_type" value="One-time Donation" required />
                                                One-time Donation - Flexible amount</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="child_gender">Preferred Child Gender</label>
                                        <select id="child_gender" name="child_gender">
                                            <option value="">No preference</option>
                                            <option value="Male">Male</option>
                                            <option value="Female">Female</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="child_age">Preferred Child Age Group</label>
                                        <select id="child_age" name="child_age">
                                            <option value="">No preference</option>
                                            <option value="5-8">5-8 years</option>
                                            <option value="9-12">9-12 years</option>
                                            <option value="13-16">13-16 years</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="col-12">
                                    <div class="form-group">
                                        <label for="special_requests">Special Requests or Preferences</label>
                                        <textarea id="special_requests" name="special_requests" rows="3" placeholder="Any specific preferences for the child you'd like to sponsor..."></textarea>
                                    </div>
                                </div>

                                <!-- Communication Preferences Section -->
                                <div class="col-12 mb-4 mt-4">
                                    <h3 style="color: #2d3b5b; border-bottom: 2px solid #8f5556; padding-bottom: 5px;">Communication Preferences</h3>
                                    <p style="color: #666;">How would you like to receive updates about your sponsored child?</p>
                                </div>
                                
                                <div class="col-12">
                                    <div class="form-group">
                                        <label>Update Frequency <span class="required">*</span></label>
                                        <div style="margin-top: 12px; display: flex; flex-direction: column; gap: 12px;">
                                            <label><input type="radio" name="update_frequency" value="Quarterly" required />
                                                Quarterly (4 times per year) - Photos, letters, and progress reports</label>
                                            <label><input type="radio" name="update_frequency" value="Biannually" required />
                                                Biannually (2 times per year) - Major updates and annual reports</label>
                                            <label><input type="radio" name="update_frequency" value="Annually" required />
                                                Annually (1 time per year) - Annual progress summary</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-12">
                                    <div class="form-group">
                                        <label>Communication Method <span class="required">*</span></label>
                                        <div style="margin-top: 12px; display: flex; flex-direction: column; gap: 12px;">
                                            <label><input type="checkbox" name="comm_method" value="Email" />
                                                Email updates</label>
                                            <label><input type="checkbox" name="comm_method" value="Physical Mail" />
                                                Physical mail (letters and photos)</label>
                                            <label><input type="checkbox" name="comm_method" value="Phone" />
                                                Phone calls for special occasions</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-12">
                                    <div class="form-group">
                                        <label for="message">Personal Message to the Child (Optional)</label>
                                        <textarea id="message" name="message" rows="3" placeholder="A message of encouragement for your sponsored child..."></textarea>
                                    </div>
                                </div>

                                <!-- Payment Information Section -->
                                <div class="col-12 mb-4 mt-4">
                                    <h3 style="color: #2d3b5b; border-bottom: 2px solid #8f5556; padding-bottom: 5px;">Payment Information</h3>
                                    <p style="color: #666;">How would you like to make your sponsorship contribution?</p>
                                </div>
                                
                                <div class="col-12">
                                    <div class="form-group">
                                        <label>Payment Method <span class="required">*</span></label>
                                        <div style="margin-top: 12px; display: flex; flex-direction: column; gap: 12px;">
                                            <label><input type="radio" name="payment_method" value="Bank Transfer" required />
                                                Bank Transfer - Direct bank deposit</label>
                                            <label><input type="radio" name="payment_method" value="Online Payment" required />
                                                Online Payment - Khalti, eSewa, or credit card</label>
                                            <label><input type="radio" name="payment_method" value="Cheque" required />
                                                Cheque - Mail to our office</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="payment_amount">Sponsorship Amount (Rs.)</label>
                                        <input type="number" id="payment_amount" name="payment_amount" placeholder="12000" min="1000" />
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="payment_frequency">Payment Frequency</label>
                                        <select id="payment_frequency" name="payment_frequency">
                                            <option value="One-time">One-time payment</option>
                                            <option value="Monthly">Monthly</option>
                                            <option value="Quarterly">Quarterly</option>
                                            <option value="Annually">Annually</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="tax_deductible">Would you like a tax deduction receipt?</label>
                                        <select id="tax_deductible" name="tax_deductible">
                                            <option value="Yes">Yes</option>
                                            <option value="No">No</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Final Section -->
                                <div class="col-12 mb-4 mt-4">
                                    <h3 style="color: #2d3b5b; border-bottom: 2px solid #8f5556; padding-bottom: 5px;">Confirm Your Sponsorship</h3>
                                    <p>Thank you for your interest in sponsoring a child through Aarambha Foundation.</p>
                                    <p>This is a dummy form for demonstration purposes. In the future, this will integrate with our backend for processing sponsorships and payments.</p>
                                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                                        <h4>What happens next?</h4>
                                        <ul style="text-align: left;">
                                            <li>We'll review your application within 2-3 business days</li>
                                            <li>You'll be matched with a child based on your preferences</li>
                                            <li>You'll receive a welcome packet with your child's information</li>
                                            <li>Regular updates will begin according to your chosen frequency</li>
                                            <li>Your first payment will be processed</li>
                                        </ul>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" required /> I agree to the terms and conditions of sponsorship and authorize Aarambha Foundation to process my donation.
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" required /> I understand that my personal information will be kept confidential and used only for sponsorship purposes.
                                        </label>
                                    </div>
                                    <button type="submit" class="start-btn" style="background: #2e8b57; margin-top: 20px;">Submit Sponsorship Application</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <a href="" class="floating-icon"><span><i class="bi bi-heart-fill"></i></span> DONATE</a>

     {% include "website/includes/footer.html" %}
    <!-- scripts start -->
    <!-- jquery  start-->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" crossorigin="anonymous"
        referrerpolicy="no-referrer"></script>
    <!-- jquery end -->
    <!-- bootstrap  start -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"
        crossorigin="anonymous"></script>
    <!-- bootstrap end -->
    <script src="{% static 'website/js/slick.min.js' %}" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- Swiper JS -->
    <script src="{% static 'website/js/swiper-bundle.min.js' %}" crossorigin="anonymous"
        referrerpolicy="no-referrer"></script>
    <script src="{% static 'website/js/modernizr.min.js' %}" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12"></script>
    <script src="{% static 'website/js/owl.carousel.min.js' %}"></script>
    <script src="{% static 'website/js/api.js' %}"></script>
    <script src="{% static 'website/js/main.js' %}"></script>
    <script src="{% static 'website/js/animation.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="{% static 'website/js/general.js' %}"></script>
    <script src="{% static 'website/js/nav.js' %}"></script>
    <script src="{% static 'website/js/script.js' %}"></script>
    <script src="{% static 'website/js/min.js' %}"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <!-- jquery  start-->
    {% include 'website/includes/login_modal.html' %}

    <!-- Hidden Config for JS -->
    <script src="{% static 'js/config.js' %}"></script>
    <script>
        let editMode = false;
        let editSponsorshipId = null;
        
        function startApplication() {
            const user = getUser();
            if (!user) {
                document.getElementById('loginModal').style.display = 'flex';
                return;
            }

            document.getElementById("startSection").style.display = "none";
            document.getElementById("sponsorshipForm").style.display = "block";
        }
        
        // Check for edit mode on page load
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const editId = urlParams.get('edit');
            
            if (editId) {
                editMode = true;
                editSponsorshipId = editId;
                loadSponsorshipForEdit(editId);
            }
            
            updateNavbarAuth();
        });
        
        async function loadSponsorshipForEdit(id) {
            try {
                const response = await fetchAPI(`/api/applications/sponsorships/${id}/`);
                const sponsorship = await response.json();
                
                // Check if user can edit this sponsorship
                if (sponsorship.status !== 'rejected' || !sponsorship.can_reapply) {
                    Swal.fire({
                        title: "Cannot Edit",
                        text: "This sponsorship application cannot be edited.",
                        icon: "error"
                    }).then(() => {
                        window.location.href = '/guest/profile/#applications';
                    });
                    return;
                }
                
                // Show form and populate fields
                document.getElementById("startSection").style.display = "none";
                document.getElementById("sponsorshipForm").style.display = "block";
                
                // Update form title
                document.querySelector('h3').textContent = 'Edit Your Sponsorship Application';
                document.querySelector('button[type="submit"]').textContent = 'Update Sponsorship Application';
                
                // Populate form fields
                document.getElementById('name').value = sponsorship.full_name || '';
                document.getElementById('email').value = sponsorship.email || '';
                document.getElementById('phone').value = sponsorship.phone || '';
                document.getElementById('country').value = sponsorship.country || 'Nepal';
                document.getElementById('city').value = sponsorship.city || '';
                document.getElementById('address').value = sponsorship.address || '';
                document.getElementById('occupation').value = sponsorship.occupation || '';
                document.getElementById('organization').value = sponsorship.organization || '';
                
                // Set radio buttons
                if (sponsorship.sponsorship_type) {
                    document.querySelector(`input[name="sponsorship_type"][value="${sponsorship.sponsorship_type}"]`).checked = true;
                }
                if (sponsorship.update_frequency) {
                    document.querySelector(`input[name="update_frequency"][value="${sponsorship.update_frequency}"]`).checked = true;
                }
                if (sponsorship.payment_method) {
                    document.querySelector(`input[name="payment_method"][value="${sponsorship.payment_method}"]`).checked = true;
                }
                
                // Set select fields
                document.getElementById('child_gender').value = sponsorship.child_gender || '';
                document.getElementById('child_age').value = sponsorship.child_age || '';
                document.getElementById('payment_frequency').value = sponsorship.payment_frequency || 'One-time';
                document.getElementById('tax_deductible').value = sponsorship.tax_deductible ? 'Yes' : 'No';
                
                // Set text areas
                document.getElementById('special_requests').value = sponsorship.special_requests || '';
                document.getElementById('message').value = sponsorship.message || '';
                document.getElementById('payment_amount').value = sponsorship.payment_amount || '';
                
                // Set communication method checkboxes
                if (sponsorship.comm_method && Array.isArray(sponsorship.comm_method)) {
                    sponsorship.comm_method.forEach(method => {
                        const checkbox = document.querySelector(`input[name="comm_method"][value="${method}"]`);
                        if (checkbox) checkbox.checked = true;
                    });
                }
                
            } catch (error) {
                console.error('Error loading sponsorship:', error);
                Swal.fire({
                    title: "Error",
                    text: "Failed to load sponsorship data.",
                    icon: "error"
                }).then(() => {
                    window.location.href = '/guest/profile/#applications';
                });
            }
        }

        // Check User Login Status and Show Modal
        function checkLoginAndShowModal() {
            const user = getUser();
            if (!user) {
                document.getElementById('loginModal').style.display = 'flex';
            } else {
                document.getElementById('loginModal').style.display = 'none';
            }
            updateNavbarAuth();
        }

        // Initial check
        document.addEventListener('DOMContentLoaded', updateNavbarAuth);

        document.getElementById("sponsorshipForm").addEventListener("submit", async function (e) {
            e.preventDefault();
            
            const user = getUser();
            if (!user) {
                Swal.fire({
                    title: "Login Required",
                    text: "Please login to submit sponsorship application.",
                    icon: "warning"
                });
                return;
            }
            
            const formData = new FormData(e.target);
            
            // Handle multiple communication methods
            const commMethods = [];
            document.querySelectorAll('input[name="comm_method"]:checked').forEach(cb => {
                commMethods.push(cb.value);
            });
            formData.delete('comm_method');
            commMethods.forEach(method => {
                formData.append('comm_method', method);
            });
            
            try {
                let response;
                if (editMode && editSponsorshipId) {
                    // Update existing sponsorship
                    response = await fetchAPI(`/api/applications/sponsorships/${editSponsorshipId}/update/`, {
                        method: 'PUT',
                        body: formData
                    });
                } else {
                    // Create new sponsorship
                    response = await fetchAPI('/api/applications/sponsorships/submit/', {
                        method: 'POST',
                        body: formData
                    });
                }
                
                if (response.ok) {
                    const data = await response.json();
                    Swal.fire({
                        title: "Success!",
                        text: editMode ? 
                            `Your sponsorship application has been updated and resubmitted successfully. Application ID: ${data.sponsorship_id}` :
                            `Your child sponsorship application has been submitted successfully. Application ID: ${data.sponsorship_id}`,
                        icon: "success"
                    }).then(() => {
                        window.location.href = '/guest/profile/#applications';
                    });
                } else {
                    const errorData = await response.json();
                    Swal.fire({
                        title: "Error",
                        text: errorData.error || "Failed to submit application",
                        icon: "error"
                    });
                }
            } catch (error) {
                console.error('Error:', error);
                Swal.fire({
                    title: "Error",
                    text: "Network error occurred. Please try again.",
                    icon: "error"
                });
            }
        });
    </script>

</body>
<script src="{% static 'js/config.js' %}"></script>

</html>