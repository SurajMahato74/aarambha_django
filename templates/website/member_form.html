{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css" />
  <link href="{% static 'website/css/bootstrap.min.css' %}" rel="stylesheet" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="{% static 'website/css/slick.min.css' %}" crossorigin="anonymous"
    referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="{% static 'website/css/owl.carousel.min.css' %}" />
  <!-- Link Swiper's CSS -->
  <link rel="stylesheet" href="{% static 'website/css/swiper-bundle.min.css' %}" />
  <!-- Link Swiper's CSS end-->
  <link rel="stylesheet" href="{% static 'website/css/animate.min.css' %}" />
  <!-- custom-css  -->
  <link rel="stylesheet" href="{% static 'website/css/index.css' %}" />
  <link rel="stylesheet" href="{% static 'website/css/style.css' %}" />
  <!-- custom-css end -->
  <link rel="icon" type="image/png" href="{% static 'website/images/favicon.png' %}" />
  <title>Aarambha Foundation &#8211; Our Beginning for the Change</title>
  <style>
    .header-top img {
      width: 100%;
      max-height: 250px;
      object-fit: cover;
      border-radius: 10px;
    }

    .header-bottom {
      color: #2d3b5b;
      background-color: #fff;
      border-top: 10px solid #8f5556;
      border-left: 1px solid #8f5556;
      border-right: 1px solid #8f5556;
      border-bottom: 1px solid #8f5556;
      padding: 5px 20px;
      border-radius: 10px 10px 0 0;
    }

    .header-bottom h1 {
      margin: 0;
      font-size: 25px;
    }

    .header-bottom .header-content p {
      color: #0b0b0b;
      text-align: justify;
    }

    .content {
      line-height: 1.6;
    }

    #membershipForm {
      display: none;
    }
    
    #membershipForm.show {
      display: block;
    }

    .start-section h2 {
      margin: 0;
      padding: 0;
    }

    .start-btn {
      background: #2d3b5b;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-size: 18px;
      cursor: pointer;
    }

    .start-btn:hover {
      background: #8f5556;
    }

    .btn-success {
      background: #8f5556 !important;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-size: 18px;
      cursor: pointer;
    }

    .btn-success:hover {
      background: #2d3b5b !important;
    }

    .form-step {
      display: none;
    }

    .form-step h2 {
      font-size: 18px;
      font-weight: 600;
    }

    .form-step p {
      color: #171717;
    }

    .form-step.active {
      display: block;
    }

    .form-group {
      margin-bottom: 10px;
    }

    label {
      text-align: left !important;
      color: #000;
      text-transform: capitalize;
      font-weight: 400;
    }

    input[type="text"],
    input[type="date"],
    input[type="email"],
    input[type="tel"],
    select,
    textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 16px;
      box-sizing: border-box;
    }

    .required {
      color: red;
    }

    .progress {
      text-align: center;
      margin: 20px 0;
      font-weight: bold;
      color: #8b6f47;
    }
  </style>
</head>

<body>
  {% include 'website/includes/navbar.html'%}

  <!-- <main class="mt-5" style="background-image: url('images/volentier.jpg'); background-size: cover; background-position: center; background-repeat: no-repeat; position: relative; min-height: 35vh; display: flex; align-items: center; justify-content: center;">
         <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.82);"></div>
         <div style="position: relative; z-index: 2; text-align: center; ">
             <h1 style="font-size: 2.6rem; font-weight: bold; margin-bottom: 0.5rem; color: #f54401;">Be a Member</h1>
             <p style="font-size: 1.2rem; margin-bottom: 0; color: #ccc;">Join our mission to empower communities and create lasting change across Nepal</p>
         </div>
        </main> -->

  <div class="container member-section">
    <div class="row justify-content-center">
      <div class="col-12 col-md-8 wow fadeInUp">
        <div class="header-top " style="margin-top: 100px; margin-bottom: 10px">
          <img src="{% static 'website/images/volentier.jpg' %}" alt="Aarambha Foundation" />
        </div>
        <div class="header-bottom mb-3 wow fadeInUp" data-wow-duration="1s" data-wow-delay="0.2s">
          <h1>Membership Application | Aarambha Foundation</h1>
          <div class="header-content">
            <p>
              Aarambha Foundation, formally registered on 3rd August 2015, is
              a non-profit, non-governmental organization working for child
              welfare, youth empowerment and social welfare. The primary focus
              of the organization is to bring each and every children of the
              nation to the light of education and then, uplifting them
              through personal and behavioral development. The organization
              believes in team work and has the tagline “Our Beginning for
              Change”.
            </p>
            <p>
              Aarambha has reached hundreds of lives since the establishment
              through the School Dropouts’ Prevention and Re-enrollment
              Project (SDPRP), Free Tuition Campaign, Rural Library Project,
              Free Health Camp and Clothes Distribution, Teaching Fellowship,
              Digital Classroom and it has changed the lives of thousands of
              youths through the motivational seminar series - Getting into
              Yourself. The journey of Aarambha has just begun and our
              enthusiastic team is on the way to touch millions of lives in
              Nepal.
            </p>
            <p>
              We are basically a group of enthusiastic youngsters who has a
              strong determination to create a change in the society. We have
              a common understanding and feeling of selflessness and we stand
              to donate a part of our life to transform the existing society
              into the better, beautiful and productive one. Through small
              efforts and planning, Aarambha Foundation and its team of
              dedicated members, come together for the greater good and
              achieve the goal of creating a positive difference in the life
              of a child or the children.
            </p>
            <p>
              If you agree with the same, join today to become a member of
              Aarambha Family.
            </p>
          </div>
          <hr style="border: 1px solid #000" />
          <div class="content">
            <div class="start-section mb-3" id="startSection">
              <h3 class="mt-1 pb-0">Ready to Join Aarambha Foundation?</h3>
              <p class="mb-0">
                Click below to start your membership application process.
              </p>
              <button class="start-btn" onclick="startApplication()">
                Start Application
              </button>
            </div>
            <form class="pb-4" id="membershipForm">
              <!-- Step 1: Personal Information -->
              <div class="form-step active" id="step1">
                <div class="row">
                  <div class="col-md-12">
                    <h2 class="mb-0 pb-0">Personal Information</h2>
                    <p>
                      We ensure your personal information won't be shared in
                      any public sites or agencies.
                    </p>
                  </div>
                  <div class="col-md-12">
                    <div class="form-group">
                      <label for="name">Name <span class="required">*</span></label>
                      <input type="text" id="name" name="full_name" placeholder="First and last name" required />
                    </div>
                  </div>
                  <div class="col-md-12">
                    <div class="form-group">
                      <label for="dob">Date of Birth <span class="required">*</span></label>
                      <input type="date" id="dob" name="date_of_birth" required />
                    </div>
                  </div>
                  <div class="col-md-12">
                    <div class="form-group">
                      <label for="tempCountry">Country (Temporary Address) <span class="required">*</span></label>
                      <select id="tempCountry" name="country" required class="w-100 p-2 ">
                        <option value="">Loading countries...</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-md-12" id="tempDistrictField" style="display:none;">
                    <div class="form-group">
                      <label for="tempDistrict">District (Temporary Address) <span class="required">*</span></label>
                      <select id="tempDistrict" name="district" class="w-100 p-2 ">
                        <option value="">Select District</option>
                        {% for district in districts %}
                        <option value="{{ district }}">{{ district }}</option>
                        {% endfor %}
                      </select>
                    </div>
                  </div>
                  <div class="col-md-12">
                    <div class="form-group">
                      <label for="tempAddress">Street Address / City (Temporary)
                        <span class="required">*</span></label>
                      <input type="text" id="tempAddress" name="temporary_address" placeholder="e.g., Kathmandu, Nepal"
                        required />
                    </div>
                  </div>
                  <div class="col-md-12">
                    <div class="form-group">
                      <label for="permAddress">Permanent Address
                        <span class="required">*</span></label>
                      <input type="text" id="permAddress" name="permanent_address" placeholder="e.g., Bhaktapur, Nepal"
                        required />
                    </div>
                  </div>

                  <div class="col-md-12">
                    <div class="form-group">
                      <label for="contactNumber">Contact Number <span class="required">*</span></label>
                      <input type="text" id="contactNumber" name="phone" placeholder="+977 9800000000" required />
                    </div>
                  </div>
                  <div class="col-md-12">
                    <div class="form-group">
                      <label for="profession">Profession and Academic Qualification, Affiliated
                        Institution:<span class="required">*</span></label>
                      <input type="text" id="profession" name="profession" placeholder="" required />
                    </div>
                  </div>
                  <div class="col-md-12">
                    <div class="form-group">
                      <label for="fb_link">Link to any one of your facebook or linkedin or
                        twitter account:<span class="required">*</span></label>
                      <input type="text" id="fb_link" name="social_link" placeholder="" required />
                    </div>
                  </div>

                  <div class="col-md-12 justify-content-end">
                    <button type="button" class="start-btn" onclick="nextStep(2)">
                      Next
                    </button>
                  </div>
                </div>
              </div>
              <!-- Step 2: Application  -->
              <div class="form-step" id="step2">
                <div class="row">
                  <div class="col-md-12">
                    <h2 class="mb-0 pb-0">Application Proper</h2>
                  </div>

                  <div class="col-md-12">
                    <div class="form-group">
                      <label for="why_join">Why do you want to join Aarambha Foundation?<span
                          class="required">*</span></label>
                      <textarea id="why_join" name="why_join" required class="w-100 p-2 "
                        rows="3"></textarea>
                    </div>
                  </div>

                  <div class="col-md-12">
                    <div class="form-group">
                      <label for="self_definition">How do you define yourself and your goal in life?<br />
                        Your hobbies, interests, key features and extra
                        curricular activities, awards and certificates would
                        define you better.
                        <span class="required">*</span></label>
                      <textarea id="self_definition" name="self_definition" required class="w-100 p-2 "
                        rows="3"></textarea>
                    </div>
                  </div>

                  <div class="col-md-12">
                    <div class="form-group">
                      <label for="ideas">What ideas can you bring if you are given a platform
                        with a full support?</label>
                      <textarea id="ideas" name="ideas" class="w-100 p-2 " rows="3"></textarea>
                    </div>
                  </div>

                  <div class="col-md-12">
                    <div class="form-group">
                      <label>What skills do you possess?
                        <span class="required">*</span><br />
                        <small>(Select all that apply)</small>
                      </label>

                      <div style="
                            display: grid;
                            grid-template-columns: repeat(
                              auto-fit,
                              minmax(200px, 1fr)
                            );
                            gap: 12px;
                            margin-top: 10px;
                          ">
                        <label><input type="checkbox" name="skills" value="Leadership" />
                          Leadership</label>
                        <label><input type="checkbox" name="skills" value="Graphics Designing" />
                          Graphics Designing</label>
                        <label><input type="checkbox" name="skills" value="Photoshop" />
                          Photoshop / Photo Editing</label>
                        <label><input type="checkbox" name="skills" value="Web Designing" />
                          Web Designing / Development</label>
                        <label><input type="checkbox" name="skills" value="Team Building" />
                          Team Building</label>
                        <label><input type="checkbox" name="skills" value="Management" />
                          Management / Coordination</label>
                        <label><input type="checkbox" name="skills" value="Social Media Marketing" />
                          Social Media Marketing</label>

                        <label style="align-items: center">
                          <input type="checkbox" id="otherSkillCheck" value="Other" />
                          Other (please specify)
                        </label>
                      </div>

                      <!-- Text box appears only when "Other" is checked -->
                      <div id="otherSkillBox" style="margin-top: 12px; display: none">
                        <input type="text" name="skills_other" placeholder="Please specify your skill..." style="
                              width: 100%;
                              padding: 12px;
                              border: 1px solid #ccc;
                              border-radius: 6px;
                            " />
                      </div>
                    </div>
                  </div>

                  <div class="col-md-12">
                    <div class="form-group">
                      <label>How much time can you give to Aarambha Foundation in
                        a week? <span class="required">*</span></label>
                      <div style="
                            margin-top: 12px;
                            display: flex;
                            flex-direction: column;
                            gap: 12px;
                          ">
                        <label><input type="radio" name="time_commitment" value="Less than 5 hours" required />
                          Less than 5 hours a week</label>
                        <label><input type="radio" name="time_commitment" value="5-10 hours" required />
                          5–10 hours a week</label>
                        <label><input type="radio" name="time_commitment" value="10-15 hours" required />
                          10–15 hours a week</label>
                        <label><input type="radio" name="time_commitment" value="15-20 hours" required />
                          15–20 hours a week</label>
                        <label><input type="radio" name="time_commitment" value="More than 20 hours" required />
                          More than 20 hours a week</label>
                      </div>
                    </div>
                  </div>

                  <div class="col-md-12">
                    <div class="form-group">
                      <label for="other_organizations">Are you involved in any other organizations? What are
                        your expectations from us? Please add remarks if you
                        have any.</label>
                      <textarea id="other_organizations" name="other_organizations" class="w-100 p-2 "
                        rows="3"></textarea>
                    </div>
                  </div>

                  <div class="col-md-12 d-none">
                    <button type="button" class="btn-success" onclick="nextStep(1)" style="background: #666">
                      Previous
                    </button>
                    <button type="button" class="start-btn" onclick="nextStep(3)">
                      Next
                    </button>
                  </div>
                </div>
              </div>

              <!-- Step 3: Document Uploads -->
              <div class="form-step" id="step3">
                <h2 class="mb-0 pb-0">Upload Required Documents</h2>
                <p style="color: #555; margin-bottom: 20px">
                  Please upload clear scans/photos of the following documents
                  (JPG, PNG or PDF • Max 10 MB each).
                </p>

                <!-- Citizenship Front -->
                <div class="form-group">
                  <label for="citizenship_front">
                    Upload Citizenship Front <span class="required">*</span>
                  </label>
                  <p style="font-size: 14px; color: #666; margin-top: -8px">
                    Upload 1 supported file. Max 10 MB.
                  </p>
                  <input type="file" id="citizenship_front" name="citizenship_front"
                    accept="image/jpeg,image/png,application/pdf" required style="
                        margin-top: 10px;
                        padding: 10px;
                        border: 2px dashed #ccc;
                        border-radius: 8px;
                        width: 100%;
                        background: #f9f9f9;
                      " />
                </div>

                <!-- Citizenship Back -->
                <div class="form-group">
                  <label for="citizenship_back">
                    Upload Citizenship Back <span class="required">*</span>
                  </label>
                  <p style="font-size: 14px; color: #666; margin-top: -8px">
                    Upload 1 supported file. Max 10 MB.
                  </p>
                  <input type="file" id="citizenship_back" name="citizenship_back"
                    accept="image/jpeg,image/png,application/pdf" required style="
                        margin-top: 10px;
                        padding: 10px;
                        border: 2px dashed #ccc;
                        border-radius: 8px;
                        width: 100%;
                        background: #f9f9f9;
                      " />
                </div>

                <!-- Photo -->
                <div class="form-group">
                  <label for="photo">
                    Upload Photo <span class="required">*</span>
                  </label>
                  <p style="font-size: 14px; color: #666; margin-top: -8px">
                    Upload 1 supported file. Max 10 MB. (Passport-size
                    preferred)
                  </p>
                  <input type="file" id="photo" name="photo" accept="image/jpeg,image/png" required style="
                        margin-top: 10px;
                        padding: 10px;
                        border: 2px dashed #ccc;
                        border-radius: 8px;
                        width: 100%;
                        background: #f9f9f9;
                      " />
                </div>

                <button type="button" class="btn-success d-none" onclick="nextStep(2)" style="background: #666">
                  Previous
                </button>
                <button type="button" class="start-btn d-none" onclick="nextStep(4)">
                  Next
                </button>
              </div>

              <!-- Step 4: Final Submission -->
              <div class="form-step" id="step4">
                <h2>Almost Done!</h2>
                <p>
                  Thank you for your interest in becoming a member of
                  <strong>Aarambha Foundation</strong>.
                </p>
                <p>
                  After submission, our team will review your application and
                  contact you soon.
                </p>
                <div class="form-group">
                  <label>
                    <input type="checkbox" required /> I agree to the terms
                    and wish to join Aarambha Foundation as a member.
                  </label>
                </div>
                <button type="button" class="btn-success" onclick="nextStep(3)" style="background: #666">
                  Previous
                </button>
                <button type="submit" class="start-btn" style="background: #2e8b57">
                  Submit Application
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>


  <footer class="footer__section wow fadeInUp" data-wow-duration="1s" data-wow-delay="0.2s">
    <div class="footer_overlay pt-5">
      <div class="container">
        <div class="row">
          <div class="col-lg-3 col-md-6 col-sm-12 mb-3">
            <div class="footer__logo">
              <img src="{% static 'website/images/logo.png' %}" width="100%" height="100%" alt="" />
            </div>
            <div class="footer__description">
              <p>
                A youth-driven foundation empowering education, equality, and
                opportunities across Nepal.
              </p>
            </div>
            <div class="social__media">
              <ul class="d-flex">
                <a href="https://www.facebook.com/aarambhafoundation">
                  <li><i class="fa-brands fa-facebook-f"></i></li>
                </a>
                <a href="https://www.instagram.com/aarambhafoundation/">
                  <li><i class="fa-brands fa-instagram"></i></li>
                </a>
                <a href="">
                  <li><i class="fa-brands fa-whatsapp"></i></li>
                </a>
                <a href="https://www.linkedin.com/company/aarambhafoundation/">
                  <li><i class="fa-brands fa-linkedin"></i></li>
                </a>
                <a href="https://www.youtube.com/channel/UCthVlyi3N4EfnGj9-pS-bMA">
                  <li><i class="fa-brands fa-youtube"></i></li>
                </a>
              </ul>
            </div>
          </div>
          <div class="col-lg-3 col-md-6 col-6 mb-3">
            <h2><span>Q</span>uick Links</h2>
            <ul class="quick-links">
              <li><a href="who-we-are">About Us</a></li>
              <li><a href="{% url 'website_member_form' %}">Be a Member</a></li>
              <li><a href="{% url 'website_volunteer_form' %}">Be a volunteer</a></li>
              <li><a href="">Our Work</a></li>
              <li><a href="">Privacy & Policy</a></li>
            </ul>
          </div>
          <div class="col-lg-3 col-md-6 col-6 mb-3">
            <h2><span>C</span>ontact Us</h2>
            <div class="contact__details">
              <ul class="fa-ul">
                <li>
                  <h6><i class="fa-solid fa-house"></i> Address</h6>
                  <span>Basundhara, Kathmandu, Nepal</span>
                </li>
                <li>
                  <h6><i class="fa-solid fa-phone"></i> Phone No</h6>
                  <span>+977 (984)346-7402</span>
                </li>
                <li>
                  <h6><i class="fa-solid fa-envelope"></i> Email</h6>
                  <span><a href="">we.aarambha@gmail.com </a></span>
                </li>
              </ul>
            </div>
          </div>
          <div class="col-lg-3 col-md-6 col-sm-12 mb-3">
            <h2><span>O</span>ur Awards</h2>
            <div class="gallery_wrapper">
              <div class="row flex-wrap">
                <div class="col-4">
                  <img src="{% static 'website/images/Award-1.jpg' %}" width="100%" height="100%" alt="" />
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="copyright">
      <div class="container">
        <div class="d-flex justify-content-center align-items-center">
          <div class="right__wrapper" style="text-align: center">
            <span style="color: white; text-align: center">
              &copy;
              <script>
                document.write(new Date().getFullYear());
              </script>
              Aarambha Foundation. All Rights Reserved.
            </span>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <!-- scripts start -->
  <!-- jquery  start-->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js" crossorigin="anonymous"
    referrerpolicy="no-referrer"></script>
  <!-- jquery end -->
  <!-- bootstrap  start -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"
    crossorigin="anonymous"></script>
  <!-- bootstrap end -->
  <script src="{% static 'website/js/slick.min.js' %}" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <!-- Swiper JS -->
  <script src="{% static 'website/js/swiper-bundle.min.js' %}" crossorigin="anonymous"
    referrerpolicy="no-referrer"></script>
  <script src="{% static 'website/js/modernizr.min.js' %}" type="text/javascript"></script>
  <script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12"></script>
  <script src="{% static 'website/js/owl.carousel.min.js' %}"></script>
  <script src="{% static 'website/js/api.js' %}"></script>
  <script src="{% static 'website/js/main.js' %}"></script>
  <script src="{% static 'website/js/animation.js' %}"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="{% static 'website/js/general.js' %}"></script>
  <script src="{% static 'website/js/nav.js' %}"></script>
  <script src="{% static 'website/js/script.js' %}"></script>
  <script src="{% static 'website/js/min.js' %}"></script>
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <!-- jquery  start-->
  <!-- Payment Modal -->
  <div id="paymentModal"
    style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; align-items: center; justify-content: center;">
    <div
      style="background: white; padding: 2rem; border-radius: 8px; max-width: 400px; width: 100%; text-align: center;">
      <h2 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 1rem; color: #111827;">Complete
        Payment</h2>
      <div style="background: #f3f4f6; padding: 1rem; border-radius: 4px; margin-bottom: 1rem;">
        <p style="color: #4b5563; font-size: 0.875rem; margin-bottom: 0.5rem;">Membership Fee</p>
        <p style="font-size: 1.875rem; font-weight: bold; color: #111827;">Rs. 1,000</p>
      </div>
      <p style="color: #4b5563; font-size: 0.875rem; margin-bottom: 1rem;">You will be redirected to
        Khalti payment gateway to complete your membership payment.</p>
      <div style="display: flex; gap: 0.5rem; justify-content: center;">
        <button onclick="proceedToPayment()"
          style="background-color: #5d2e8e; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: 600;">Pay
          with Khalti</button>
        <button onclick="closePaymentModal()"
          style="background-color: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 5px; margin-left: 10px; cursor: pointer;">Cancel</button>
      </div>
    </div>
  </div>
  </div>

  {% include 'website/includes/login_modal.html' %}

  <!-- Hidden Config for JS -->
  <script src="{% static 'js/config.js' %}"></script>
  <script>
    // CSRF token helper function
    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }
    
    function startApplication() {
      // Check both Django session and localStorage token
      const user = getUser();
      const isDjangoAuthenticated = window.djangoUser && window.djangoUser.isAuthenticated;
      
      if (!user && !isDjangoAuthenticated) {
        document.getElementById('loginModal').style.display = 'flex';
        return;
      }

      // Only show form if logged in
      document.getElementById("startSection").style.display = "none";
      const form = document.getElementById("membershipForm");
      form.style.display = "block";
      form.classList.add("show");
    }


    function nextStep(step) {
      console.log('Moving to step:', step);
      
      // Show all steps instead of hiding them
      document.querySelectorAll(".form-step").forEach((s, index) => {
        s.style.cssText = `
          display: block !important;
          visibility: visible !important;
          opacity: 1 !important;
          position: static !important;
          width: 100% !important;
          background: white !important;
          padding: 20px !important;
          margin: 10px 0 !important;
          border: ${index + 1 === step ? '2px solid blue' : '1px solid #ccc'} !important;
        `;
      });
      
      const targetStep = document.getElementById("step" + step);
      if (targetStep) {
        setTimeout(() => {
          targetStep.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 100);
        console.log('All steps visible, highlighting step:', step);
      }
    }

    // Check User Login Status and Show Modal
    function checkLoginAndShowModal() {
      const user = getUser();
      if (!user) {
        document.getElementById('loginModal').style.display = 'flex';
      } else {
        document.getElementById('loginModal').style.display = 'none';
      }
      updateNavbarAuth();
    }

    // Initial check

    document.addEventListener('DOMContentLoaded', updateNavbarAuth);
      const originalHandleModalLogin = window.handleModalLogin;
      window.handleModalLogin = async function (e) {
        e.preventDefault();
        const username = document.getElementById("modalUsername").value;
        const password = document.getElementById("modalPassword").value;
        const errorDiv = document.getElementById("modalLoginError");
        const btn =
          e.submitter || e.target.querySelector('button[type="submit"]');

        btn.disabled = true;
        btn.innerHTML = "Logging in...";
        errorDiv.textContent = "";

        try {
          const response = await fetch("/api/users/login/", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username, password }),
          });
          const data = await response.json();

          if (response.ok) {
            setToken(data.access, data.refresh);
            setUser(data.user);
            document.getElementById("loginModal").style.display = "none";

            updateNavbarAuth();

            if (showFormAfterLogin) {
              showFormAfterLogin = false;
              document.getElementById("startSection").style.display = "none";
              document.getElementById("membershipForm").style.display = "block";
            }
          } else {
            errorDiv.textContent =
              data.non_field_errors?.[0] ||
              "Login failed. Please check credentials.";
          }
        } catch (error) {
          console.error(error);
          errorDiv.textContent = "Network error. Please try again.";
        } finally {
          btn.disabled = false;
          btn.innerHTML = "Login";
        }
      };

      // Override OTP login too
      const originalVerifyModalOTP = window.verifyModalOTP;
      window.verifyModalOTP = async function (btn) {
        const email = document.getElementById("modalEmail").value;
        const otp = document.getElementById("modalotpInput").value;
        const errorDiv = document.getElementById("modalOtpError");

        if (!otp || otp.length < 6) {
          errorDiv.textContent = "Invalid OTP";
          return;
        }

        btn.disabled = true;
        btn.innerHTML = "Verifying...";

        try {
          const response = await fetch("/api/users/verify-otp/", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, otp }),
          });
          const data = await response.json();

          if (response.ok) {
            setToken(data.access, data.refresh);
            setUser(data.user);
            document.getElementById("loginModal").style.display = "none";

            updateNavbarAuth();

            if (showFormAfterLogin) {
              showFormAfterLogin = false;
              document.getElementById("startSection").style.display = "none";
              document.getElementById("membershipForm").style.display = "block";
            }
          } else {
            errorDiv.style.color = "#dc3545";
            errorDiv.textContent = data.error || "Invalid OTP";
          }
        } catch (e) {
          errorDiv.style.color = "#dc3545";
          errorDiv.textContent = "Error verifying OTP";
        } finally {
          btn.disabled = false;
          btn.innerHTML = "Verify & Login";
        }
      };




    // Load Countries
    fetch('https://restcountries.com/v3.1/all?fields=name')
      .then(res => res.json())
      .then(data => {
        const select = document.getElementById('tempCountry');
        const sorted = data.sort((a, b) => a.name.common.localeCompare(b.name.common));
        select.innerHTML = sorted.map(c =>
          `<option value="${c.name.common}" ${c.name.common === 'Nepal' ? 'selected' : ''}>${c.name.common}</option>`
        ).join('');
        toggleDistrictField();
      })
      .catch(err => {
        console.error('Failed to load countries:', err);
        document.getElementById('tempCountry').innerHTML = '<option value="Nepal" selected>Nepal</option>';
        toggleDistrictField();
      });

    // Toggle district field based on country
    document.getElementById('tempCountry').addEventListener('change', toggleDistrictField);

    function toggleDistrictField() {
      const country = document.getElementById('tempCountry').value;
      const districtField = document.getElementById('tempDistrictField');
      const districtSelect = document.getElementById('tempDistrict');

      if (country === 'Nepal') {
        districtField.style.display = 'block';
        districtSelect.required = true;
      } else {
        districtField.style.display = 'none';
        districtSelect.required = false;
        districtSelect.value = '';
      }
    }

    document.getElementById("membershipForm").addEventListener("submit", async function (e) {
      e.preventDefault();

      // Basic Validation if needed

      const formData = new FormData(e.target);

      // Add default values for fields not in UI
      // formData.append('country', 'Nepal'); // dynamic now

      const country = document.getElementById('tempCountry').value;
      const district = document.getElementById('tempDistrict').value;

      formData.append('country', country);
      if (country === 'Nepal' && district) {
        formData.append('district', district);
      }

      formData.append('application_type', 'member');

      // Handle Skills
      const skills = [];
      document.querySelectorAll('input[name="skills"]:checked').forEach(cb => {
        skills.push(cb.value);
      });
      // Check for "other" text
      const otherSkillText = document.querySelector('input[name="skills_other"]')?.value;
      if (otherSkillText && skills.includes('Other')) {
        // Append detail to Other or just add it
        // Start-up ghar backend likely just takes the list. 
        // We can replace "Other" with "Other: value" or just append it.
        skills.push(`Other: ${otherSkillText}`);
      }
      formData.delete('skills');
      formData.append('skills', JSON.stringify(skills));

      const submitBtn = e.submitter || document.querySelector('button[type="submit"]');
      const originalText = submitBtn.innerHTML;
      submitBtn.innerHTML = 'Submitting...';
      submitBtn.disabled = true;

      try {
        // Check authentication method
        const token = getToken();
        const isDjangoAuthenticated = window.djangoUser && window.djangoUser.isAuthenticated;
        
        if (!token && !isDjangoAuthenticated) {
          alert('Please login first to submit the application.');
          window.location.href = '/accounts/login/';
          return;
        }

        // Use appropriate authentication method
        const headers = {};
        if (token) {
          headers['Authorization'] = `Bearer ${token}`;
        }
        
        // Add CSRF token for session auth
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]')?.value || 
                         document.querySelector('meta[name=csrf-token]')?.content ||
                         getCookie('csrftoken');
        if (csrfToken) {
          headers['X-CSRFToken'] = csrfToken;
        }
        // For Django session auth, credentials are sent automatically

        const response = await fetch('/api/applications/submit/', {
          method: 'POST',
          headers: headers,
          body: formData,
          credentials: 'include' // Include cookies for session auth
        });

        const data = await response.json();

        if (response.ok) {
          if (data.payment_required) {
            window.applicationId = data.application.id;
            document.getElementById('paymentModal').classList.remove('hidden');
            // Fix modal class for flex display (tailwind 'hidden' vs 'flex')
            document.getElementById('paymentModal').style.display = 'flex';
          } else {
            Swal.fire({
              title: "Success!",
              text: "Application submitted successfully!",
              icon: "success"
            }).then(() => {
              window.location.href = '/guest/welcome/';
            });
          }
        } else {
          console.error(data);
          let errorMsg = 'Submission failed.';
          if (typeof data === 'object') {
            errorMsg = Object.entries(data).map(([k, v]) => `${k}: ${v}`).join('\n');
          }
          Swal.fire({
            title: "Error!",
            text: errorMsg,
            icon: "error"
          });
        }
      } catch (error) {
        console.error(error);
        Swal.fire({
          title: "Error!",
          text: "Network error. Please try again.",
          icon: "error"
        });
      } finally {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
      }
    });

    function closePaymentModal() {
      document.getElementById('paymentModal').style.display = 'none';
    }

    async function proceedToPayment() {
      try {
        const response = await fetchAPI(`/api/applications/${window.applicationId}/initiate-payment/`, {
          method: 'POST'
        });

        const data = await response.json();

        if (response.ok && data.payment_url) {
          window.location.href = data.payment_url;
        } else {
          alert('Failed to initiate payment. Please try again.');
        }
      } catch (error) {
        alert('Error initiating payment. Please try again.');
      }
    }
  </script>

</body>

</html>